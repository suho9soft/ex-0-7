import tkinter as tk
from tkinter import font
import paho.mqtt.client as mqtt
import threading

# MQTT ë¸Œë¡œì»¤ ì •ë³´
MQTT_BROKER = "broker.emqx.io"
MQTT_PORT = 1883
MQTT_TOPICS = [
    "arduino/led1",
    "arduino/led2",
    "arduino/led3",
    "arduino/led4",
    "arduino/led5",
    "arduino/led6",
    "arduino/led7",
    "arduino/led8",
]

# MQTT í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
client = mqtt.Client()

def connect_mqtt():
    try:
        client.connect(MQTT_BROKER, MQTT_PORT, 60)
        print("Connected to MQTT Broker!")
        client.loop_start()  # ë°±ê·¸ë¼ìš´ë“œì—ì„œ MQTT ë£¨í”„ ì‹¤í–‰
    except Exception as e:
        print(f"Failed to connect to MQTT Broker: {e}")

# LED ì œì–´ í•¨ìˆ˜
def toggle_led(topic, state):
    payload = "1" if state else "0"
    client.publish(topic, payload)
    print(f"Published to {topic}: {payload}")

# GUI ìƒì„±
def create_gui():
    window = tk.Tk()
    window.title("Zerg Hive Control")
    window.geometry("500x700")
    window.configure(bg="#2B1B20")  # ì €ê·¸ì˜ ë‹¤í¬ í…Œë§ˆ ìƒ‰ìƒ

    # ì €ê·¸ ìŠ¤íƒ€ì¼ í°íŠ¸
    zerg_font = font.Font(family="Courier New", size=12, weight="bold")
    zerg_title_font = font.Font(family="Courier New", size=18, weight="bold")

    # ì œëª©
    title = tk.Label(
        window,
        text="ğŸŒ€ ZERG HIVE CONTROL ğŸŒ€",
        font=zerg_title_font,
        bg="#2B1B20",
        fg="#D16D6D"
    )
    title.pack(pady=20)

    # ë²„íŠ¼ê³¼ ë¼ë²¨ ì¶”ê°€
    labels = [
        "Hatchery 1", "Hatchery 2", "Spawning Pool", "Hydralisk Den",
        "Evolution Chamber", "Lair", "Hive", "Nydus Canal"
    ]
    buttons = []

    # ë²„íŠ¼ ë° ë ˆì´ë¸” ë°°ì¹˜
    for i, label in enumerate(labels):
        led_state = tk.BooleanVar(value=False)

        # ë²„íŠ¼ ë™ì‘ ì •ì˜
        def toggle(index=i):
            current_state = led_state.get()
            toggle_led(MQTT_TOPICS[index], not current_state)
            led_state.set(not current_state)
            buttons[index].configure(
                bg="#4C1E2D" if led_state.get() else "#7F1734", 
                fg="#F6E6E6"
            )

        # ë ˆì´ë¸”
        lbl = tk.Label(
            window,
            text=f"{label} (LED {i+1})",
            font=zerg_font,
            bg="#2B1B20",
            fg="#D3D3D3"
        )
        lbl.pack(pady=5)

        # ë²„íŠ¼
        btn = tk.Button(
            window,
            text=f"Toggle LED {i+1}",
            font=zerg_font,
            width=20,
            height=2,
            bg="#7F1734",
            fg="#F6E6E6",
            activebackground="#4C1E2D",
            activeforeground="#F8D8D8",
            command=toggle,
            relief="raised",
            bd=6,
        )
        btn.pack(pady=5)
        buttons.append(btn)

    # ë©”ì¸ ë£¨í”„ ì‹¤í–‰
    window.mainloop()

# ë©”ì¸ í•¨ìˆ˜
if __name__ == "__main__":
    connect_mqtt()
    # GUIë¥¼ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰
    gui_thread = threading.Thread(target=create_gui)
    gui_thread.start()
